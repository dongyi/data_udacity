A/B 测试最终项目
=========================


度量选择
-------------

* cookie数量: 不变度量。
  我们改变“开始免费试学”页面的时候，访问网站的用户数量不会发生变化。因为他们在看到这个页面之前已经访问了网站，所以这是个不变指标

* user-ids数量: 不是不变度量也不是评估度量。

  因为注册数量可能依赖是否点击“开始免费试学”页面。所以不是一个不变指标。因为实验组和对照组的cookie数量不同,因此用户id可能不是因为实验影响而不同, 所以使用用户id可能不能很好的评估实验效果. 因此用户id也不是一个评估度量

* 点击数: 不变度量。
  和cookie数量类似，这个指标不依赖是否展示“开始免费试学”页面。因为他们点击之前是没有显示这个页面的

* 点击率: 不变度量。
  因为用户在点击按钮之前并没有看到这个页面， 点击率也是不依赖我们的测试内容的

* 总转化率: 是一个评估度量。   
  是否决定开始课程是依赖用户是否看见“开始免费试学”页面的。所以这是一个很好的评估指标

* 留存率: 是一个评估度量。 
  类似的，我们想要知道“是否每周有5小时以上时间”的建议是否对提高付费比例有帮助，所以这是一个很好的度量。

* 净转化率 是一个评估度量。 
  净转化率是前面两个（总转化率和留存率）计算出来的，因此这也是一个很好的度量

期望结果
-------------

  预期实验会使总转化率和净转化率有显著的增加


测量可变性
---------------------

* 计算标准差 基准表

|                   | Value  | 
| ----------------------------- |:--------:| 
| Unique cookies to view page per day       | 40000   | 
| Unique cookies to click "Start free trial" per day            | 3200   |  
| Enrollments per day                        | 660   |
| Click-through-probability on "Start free trial"               | 0.08   |
| Probability of enrolling, given click           | 0.20625   |
| Probability of payment, given enroll          | 0.53   |
| Probability of payment, given click           | 0.1093125    |


根据伯努力分布的标准差公式`std = sqrt(p * (1-p) / N)`
计算以下三个度量

### 总转化率

总转化率基准值是  `p = 0.20625` 参加测试的样本数 `N = 5000 * 0.08 = 400`
可以得出标准差 `std = sqrt(p * (1-p) / N) = 0.0202`.


### 留存率

留存率的基准值是 `p = 0.53`，参加测试的样本数 `N = 5000 * 0.08 * 0.20625 = 82.5`. 
可以得出标准差 `std = sqrt(p * (1-p) / N) = 0.0549`.

### 净转化率

净转化率基准值 `p = 0.1093125`，参加测试的样本数`N = 5000 * 0.08 = 400`.
可以得出标准差 `std = sqrt(p * (1-p) / N) = 0.0156`.


#### 作为你选择作为评估度量的每个度量，用分析法估计其标准偏差。你预期分析估计是准确的吗？也就是说，如果你有足够的时间，你会为哪个度量收集变异的经验估计？

总转化率和净转化率都是用cookie数量作为分母， 因此，转移单位等于分析单位，表明分析变异性可以匹配经验变异性。 
本试验的转移单位应该是cookie, 所以留存率的分析单位与试验的转移单位不能匹配，因此分析变异性不能匹配经验变异性。


规模
---------------------


### 选择支持的样本数量

这里不应该使用 Bonferroni修正, 因为测试中使用的度量有较强的相关性。使用bonferroni修正可能会导致结果比较保守
根据[在线计算器](http://www.evanmiller.org/ab-testing/sample-size.html) 
使用参数`alpha = 0.05`, `1 - beta = 0.2` 来计算需要多少样本数

* 总转化率. 
  基准值是 0.20625, `d_min`=0.01. 计算出结果是 25835.
  这个结果是点击了“开始免费试学”的，所以需要的总pv是 `25835 / 0.08 * 2 = 645875` 

* 留存率. 基准值是 0.53, `d_min` = 0.01. 计算出结果是 39115.
  同上， 我们需要的pv是 `39115 / 0.08 / 0.20625 * 2 = 4741212`

* 净转化率. 基准值是 0.1093125, `d_min` = 0.0075. 计算出结果是 27413. 
  我们需要的pv是 `27413 / 0.08 * 2 = 685325`

可以看出，如果使用留存率作为评估度量，需要的pv可能过大了。可能需要太多测试时间。
所以我们不使用留存率来测试，最后我们选出总转化率和净转化率作为评估度量

我们需要的pv是685325（其中较大的）


### 选择持续时间和风险暴露

  我们使用70%的流量来测试， 总的用时是： `685325 / (40000 * 0.7) = 24.5` 天
  在测试用时和风险暴露之间有较好的平衡. 
  * 即使学生每周学不到五小时，他们只是被页面的变更提醒引导到了另外的一个页面，如果今后有需要学生仍然可以进入免费试学、登陆并可能完成继续课程的，不会因此影响用户使用网站的习惯.
  * 没有在页面展示上有过大的改动，不会对用户产生感情上的冲击，用户也不需要花长时间去适应页面的改变。
  * 该试验没有关于数据库及后台的改变，不用担心数据的丢失及由于后台的失误导致网页奔溃用户无法访问网页等大问题。
  * 此试验也不会对用户的个人信息安全造成风险，因为不论网页是否增加了提醒，用户在确认参加免费试学时都得输入信用卡信息，而很明显系统一定会保护用户的个人信息。
  * 该试验同样也没有道德上的风险。

## 分析

### 合理性检查

 对每个不变度量, 计算标准差`std = sqrt(0.5 * 0.5 / (N_1 + N_2))`
 上下界是 `0.5 - 1.96*std` `0.5 + 1.96*std`  不使用 Bonferroni 校正


| 度量        |control group|experiment group|标准差            | 下界  | 上界 | 观察值 |  合理性 |
| ----|:------|:--------|:-------------- |:--------:| :-----------: | :-------: | :----------: |
| cookie数量  | 345543|344660 |   0.0006018        | 0.4988   | 0.5012   | 0.5006 | Yes |
| 点击"免费试学"数量     |28378|28325|  0.0021      | 0.4959   | 0.5041   | 0.5005 | Yes |
| 点击率   |0.0821258| 0.0821824| 0.000468 | 0.0812   | 0.0830   | 0.0822 | Yes |


#### 同理对于评估度量，计算结果如下

##### 总转化率

    clicks_controlled = 17293.
    enroll_controlled = 3785.
    clicks_experiment = 17260.
    enroll_experiment = 3423.

    p_pooled = (clicks_experiment + enroll_experiment) / (clicks_controlled + enroll_controlled) = 0.2086
    se_pooled = math.sqrt(p_pooled * (1-p_pooled) * (1/clicks_controlled + 1/clicks_experiment)) = 0.00437

    d = enroll_experiment / clicks_experiment - enroll_controlled / clicks_controlled = -0.02055

    lower = d - se_pooled = -0.0291
    upper = d - se_pooled = -0.0120

 结果未覆盖0值，因此有统计显著性，也不包括0.01和-0.01（实际显著性边界），因此也有实践显著性

##### 净转化率

    clicks_controlled = 17293.
    pay_controlled = 2033.
    enroll_experiment = 17260.
    pay_experiment = 1945.

    p_pooled = (pay_controlled + pay_experiment) / (clicks_controlled + enroll_experiment) = 0.1151
    se_pooled = sqrt(p_pooled * (1-p_pooled) * (1./clicks_controlled + 1./N_exp)) = 0.00343

    d = pay_experiment / enroll_experiment - pay_controlled / clicks_controlled = -0.0048

    lower = d - se_pooled = -0.0116
    upper = d + se_pooled = 0.0019

区间覆盖0值，因此不具有统计显著性和实践显著性


### 符号检验

使用 [在线计算器](http://graphpad.com/quickcalcs/binomial1.cfm) 计算. 根据之前的计算结果

| 度量                    | p值 | 统计显著性 |
| ----------------- |:--------:| :---------: |
| 总转化率           |  0.0026   | 是 |
| 净转化率           |  0.6776   | 否 | 




### 建议

  总转化率：结果显示总转化率有降低，而且具有统计显著性和实践显著性; 可能是因为多数人在看到时间要求后有一定的挫败感。但是可能会提高用户质量，对最终的付费率有所提高

  净转化率：净转化率实验结果都比较有限，不具有统计显著性和实践显著性，就是说有一定概率净转化率会减少。

  根据上面的分析和推理，总转化率得到了显著的结果，因为筛掉了最终可能不会付费的用户来降低成本。另一方面， 净转化率在统计上实际上是没有显著性的， 这意味着，可能会导致付费减少。 不会增加付费用户的数量，这不符合启动此功能的初始目标，并且可能是不可接受的启动风险。所以我们最终建议是不启动实验。


### 后续试验：如何减少提前终止

  建议可以增加一个“加入学习互助小组”的按钮，相比于学生直接面对视频和文字的课程，学生形成的互助小组好处有：
  1）可能更容易让学生产生继续学习下去的动力
  2）减少放弃课程的可能性。

#### 假设：在课程初期加入学习互助小组

#### 度量选择：

* 不变度量：

 用户id的数量：
  此试验是在登录用户点击加入学习互助小组，不会影响到登录用户数量，因此选择用户id做不变度量；

* 评估度量：

 留存率；
  试验可能会影响最终付费用户数量，留存率是个很好的评估指标；

* 转移单位：

 用户id：测试发生在用户登录后，id会被跟踪，用户id是合适的转移单位；
